#!/usr/bin/env python2

starting_index = 0

characters = [
   ["*  *", # 0 - null
    " ** ",
    " ** ",
    "*  *"],
   [" ** ", # 1 - half sine wave
    "*  *",
    "    ",
    "    "],
   ["    ", # 2 - second half sine wave
    "    ",
    "*  *",
    " ** "],
   ["   *", # 3 - part of saw wave
    "  **",
    " *  ",
    "*   "],
   ["   *", # 4 - second part of saw wave
    "  * ",
    "**  ",
    "*   "],
   [" *  ", # 5 - first part of square
    " *  ",
    " *  ",
    " ***"],
   ["****", # 6 - second part of square wave
    "*  *",
    "*  *",
    "*  *"],
   ["* * ", # 7 - noise
    " * *",
    "* * ",
    " * *"],
   ["    ", # 8 - white noise spectrum
    "    ",
    "****",
    "****"],
   ["*   ", # 9 - red noise spectrum
    "**  ",
    "*** ",
    "****"],
   ["   *", # 10 - violet noise spectrum
    "  **",
    " ***",
    "****"],
   ["   *", # 11 - bend up
    "   *",
    "  * ",
    "**  "],
   ["**  ", # 12 - bend down
    "  * ",
    "   *",
    "   *"],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["    ", # ' '
    "    ",
    "    ",
    "    "],
   [" *  ", # !
    " *  ",
    "    ",
    " *  "],
   ["* * ", # "
    "* * ",
    "    ",
    "    "],
   [" * *", # #
    "****",
    " * *",
    "****"],
   [" ***", # $
    "* * ",
    " * *",
    "*** "],
   ["** *", # %
    "* * ",
    " * *",
    "* **"],
   [" ** ", # &
    "****",
    "* * ",
    " ** "],
   [" *  ", # '
    " *  ",
    "    ",
    "    "],
   [" ** ", # (
    "**  ",
    "**  ",
    " ** "],
   [" ** ", # )
    "  **",
    "  **",
    " ** "],
   [" * *", # *
    "  * ",
    " * *",
    "    "],
   ["  * ", # +
    " ***",
    "  * ",
    "    "],
   ["    ", # ,
    "    ",
    " ** ",
    "  * "],
   ["    ", # -
    " ***",
    "    ",
    "    "],
   ["    ", # .
    "    ",
    " ** ",
    " ** "],
   ["   *", # /
    "  * ",
    " *  ",
    "*   "],
   ["****", # 0
    "** *",
    "** *",
    "****"],
   ["*** ", # 1
    " ** ",
    " ** ",
    "****"],
   ["*** ", # 2
    "  **",
    "**  ",
    "****"],
   ["****", # 3
    " ***",
    "   *",
    "****"],
   ["* **", # 4
    "****",
    "  **",
    "  **"],
   ["****", # 5
    "*** ",
    "  **",
    "*** "],
   ["****", # 6
    "**  ",
    "* **",
    "****"],
   ["****", # 7
    "  **",
    " ** ",
    " ** "],
   ["*** ", # 8
    "* **",
    "** *",
    " ***"],
   ["****", # 9
    "** *",
    "  **",
    "****"],
   [" *  ", # :
    "    ",
    " *  ",
    "    "],
   [" *  ", # ;
    "    ",
    " ** ",
    "  * "],
   ["  * ", # <
    " *  ",
    "  * ",
    "    "],
   [" ***", # =
    "    ",
    " ***",
    "    "],
   [" *  ", # >
    "  * ",
    " *  ",
    "    "],
   ["**  ", # ?
    "  * ",
    " ** ",
    "*   "],
   ["****", # @
    "   *",
    "** *",
    "****"],
   [" ** ", # A
    "* **",
    "****",
    "* **"],
   ["*** ", # B
    "* **",
    "** *",
    "****"],
   [" ***", # C
    "*** ",
    "*** ",
    " ***"],
   ["*** ", # D
    "** *",
    "** *",
    "*** "],
   ["****", # E
    "*** ",
    "**  ",
    "****"],
   ["****", # F
    "**  ",
    "*** ",
    "**  "],
   [" ***", # G
    "**  ",
    "** *",
    "****"],
   ["* **", # H
    "****",
    "* **",
    "* **"],
   ["****", # I
    " ** ",
    " ** ",
    "****"],
   ["****", # J
    "  **",
    "  **",
    "*** "],
   ["** *", # K
    "*** ",
    "** *",
    "** *"],
   ["**  ", # L
    "**  ",
    "**  ",
    "****"],
   ["****", # M
    "****",
    "* **",
    "*  *"],
   ["** *", # N
    "** *",
    "* **",
    "* **"],
   [" ** ", # O
    "** *",
    "** *",
    " ** "],
   ["****", # P
    "** *",
    "****",
    "**  "],
   ["****", # Q
    "*  *",
    "* **",
    "****"],
   ["*** ", # R
    "** *",
    "*** ",
    "* **"],
   ["****", # S
    "**  ",
    "  **",
    "****"],
   ["****", # T
    " ** ",
    " ** ",
    " ** "],
   ["* **", # U
    "* **",
    "* **",
    "****"],
   ["** *", # V
    "** *",
    "*** ",
    " *  "],
   ["*  *", # W
    "** *",
    "****",
    "****"],
   ["** *", # X
    "  * ",
    "** *",
    "** *"],
   ["** *", # Y
    "** *",
    " ** ",
    " **"],
   ["****", # Z
    "  **",
    "**  ",
    "****"],
   ["*** ", # [
    "**  ",
    "**  ",
    "*** "],
   ["*   ", # \
    " *  ",
    "  * ",
    "   *"],
   [" ***", # ]
    "  **",
    "  **",
    " ***"],
   ["  * ", # ^
    " * *",
    "    ",
    "    "],
   ["    ", # _
    "    ",
    "    ",
    "****"],
   [" *  ", # `
    "  * ",
    "    ",
    "    "],
   ["    ", # a
    " ***",
    "* **",
    "****"],
   ["**  ", # b
    "*** ",
    "** *",
    "*** "],
   ["    ",
    " ***", # c
    "**  ",
    " ***"],
   ["  **", # d
    " ***",
    "* **",
    " ***"],
   [" ** ", # e
    "** *",
    "*** ",
    " ***"],
   [" ***", # f
    "**  ",
    "*** ",
    "**  "],
   [" ** ", # g
    "* **",
    " ***",
    "*** "],
   ["**  ", # h
    "**  ",
    "****",
    "** *"],
   [" ** ", # i
    "    ",
    " ** ",
    " ***"],
   ["  **", # j
    "    ",
    "  **",
    "****"],
   ["**  ", # k
    "** *",
    "*** ",
    "** *"],
   [" ** ", # l
    " ** ",
    " ** ",
    " ** "],
   ["    ", # m
    "****",
    "* **",
    "*  *"],
   ["    ", # n
    "*** ",
    "** *",
    "** *"],
   ["    ", # o
    " ** ",
    "** *",
    " ** "],
   ["*** ", # p
    "** *",
    "*** ",
    "**  "],
   [" ***", # q
    "* **",
    " ***",
    "  **"],
   ["    ", # r
    "*** ",
    "** *",
    "**  "],
   ["    ",
    " ***", # s
    " ** ",
    "*** "],
   [" ** ", # t
    "****",
    " ** ",
    " ***"],
   ["    ", # u
    "* **",
    "* **",
    "****"],
   ["    ", # v
    "** *",
    "*** ",
    " *  "],
   ["    ",
    "*  *", # w
    "** *",
    "****"],
   ["    ", # x
    "** *",
    "  * ",
    "** *"],
   ["    ", # y
    " * *",
    " ***",
    "***"],
   ["    ", # z
    "*** ",
    " ** ",
    " ***"],
   [" ** ", # {
    "**  ",
    " *  ",
    " ** "],
   ["  * ", # |
    "  * ",
    "  * ",
    "    "],
   [" ** ", # }
    "  **",
    "  * ",
    " ** "],
   ["   *", # ~
    " ***",
    " *  ",
    "    "],
   ["    ", # 127
    " ** ",
    " ** ",
    "    "],
   [" ** ", # 128 - integral
    " *  ",
    " *  ",
    "**  "],
   ["****", # 129 - Gamma (skip Alpha, Beta, they look like A, B)
    "**  ",
    "**  ",
    "**  "],
   ["  * ", # 130 - Delta
    " * *",
    "** *",
    "****"],
   ["****", # 131 - Theta (skip Epsilon, Zeta, Eta, they look like E, Z, H)
    "** *",
    "* **",
    "****"],
   [" *  ", # 132 - Lambda (skip Iota, Kappa, they look like l, K)
    "* * ",
    "* **",
    "* **"],
   ["****", # 133 - Xi (skip Mu, Nu, they look like M, N)
    " ** ",
    "    ",
    "****"],
   ["****", # 134 - Pi (skip Omicron, it looks like O)
    "* **",
    "* **",
    "* **"],
   ["****", # 135 - Sigma (skip Rho, it looks like P)
    " ** ",
    "*   ",
    "****"],
   ["* **", # 136 - Phi (skip Tau, Upsilon, they look like T, Y)
    " * *",
    "* * ",
    "** *"],
   ["*  *", # 137 - Psi (skip Chi, it looks like X)
    "* * ",
    " *  ",
    "* **"],
   [" ** ", # 138 - Omega
    "*  *",
    "** *",
    "** *"],
   ["", # 139
    "",
    "",
    ""],
   ["", # 140
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", # 144
    "",
    "",
    ""],
   ["   *", # 145 - alpha
    " ** ",
    "* * ",
    "** *"],
   [" ** ", # 146 - beta
    " ** ",
    " * *",
    "****"],
   ["*  *", # 147 - gamma
    " ** ",
    "* * ",
    "**  "],
   [" *  ", # 148 - delta
    " ** ",
    "* **",
    " ** "],
   [" ** ", # 149 - epsilon
    " ***",
    "*   ",
    " ** "],
   [" ***", # 150 - zeta
    "*   ",
    "*** ",
    "   * "],
   ["*** ", # 151 - eta
    "*  *",
    "*  *",
    "   * "],
   [" ** ", # 152 - theta
    "** *",
    "* **",
    " ** "],
   ["    ", # 153 - iota
    " ** ",
    " ** ",
    " ** "],
   ["    ", # 154 - kappa
    "** *",
    "*** ",
    "** *"],
   ["**  ", # 155 - lambda
    "  * ",
    " * *",
    "*  *"],
   ["    ", # 156 - mu
    "*  *",
    "****",
    "   *"],
   ["    ", # 157 - nu
    "** *",
    " ** ",
    " *  "],
   ["**  ", # 158 - xi
    "*** ",
    "*   ",
    " ***"],
   ["    ", # 159 - skip omicron, go to pi
    "****",
    "* * ",
    "* * "],
   ["  * ", # 160 - rho 
    " * *",
    " ** ",
    "**  "],
   ["    ", # 161 - sigma (circle)
    " ***",
    "* * ",
    " *  "],
   [" ** ", # 162 - sigma (open)
    "*   ",
    " ***",
    "   *"],
   ["    ", # 163 - tau
    "****",
    " ** ",
    " ** "],
   ["    ", # 164 - upsilon
    "*  *",
    " * *",
    " ** "],
   ["*   ", # 165 - phi
    " ** ",
    " ** ",
    "   *"],
   ["** *", # 166 - chi
    " ** ",
    "* * ",
    "  **"],
   [" * *", # 167 - psi
    " ** ",
    " ***",
    "*   "],
   ["    ", # 168 - omega
    "*  *",
    "** *",
    " ** "],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["", 
    "",
    "",
    ""],
   ["****", # 224
    "****",
    "****",
    "****"],
   ["   *", 
    "    ",
    "    ",
    " *  "],
   ["   *", 
    "*   ",
    "    ",
    " *  "],
   ["   *", 
    "*   ",
    "    ",
    "**  "],
   ["    ", 
    "    ",
    "****",
    "****"],
   ["    ", 
    "****",
    "****",
    "    "],
   ["****", 
    "****",
    "    ",
    "    "],
   ["****", 
    "    ",
    "    ",
    "****"],
   ["    ", 
    "    ",
    "    ",
    "****"],
   ["    ", 
    "    ",
    "****",
    "    "],
   ["    ", 
    "****",
    "    ",
    "    "],
   ["****", 
    "    ",
    "    ",
    "    "],
   ["*   ", 
    "*   ",
    "*   ",
    "*   "],
   [" *  ", 
    " *  ",
    " *  ",
    " *  "],
   ["  * ", 
    "  * ",
    "  * ",
    "  * "],
   ["   *", 
    "   *",
    "   *",
    "   *"], 
   ["    ", # 240 -> zero
    "    ",
    "    ",
    "    "],
   ["    ", # 241
    "    ",
    "    ",
    "****"],
   ["    ", # 242
    "    ",
    "****",
    "    "],
   ["    ", # 243
    "    ",
    "****",
    "****"],
   ["    ", # 244
    "****",
    "    ",
    "    "],
   ["    ", # 245
    "****",
    "    ",
    "****"],
   ["    ", # 246
    "****",
    "****",
    "    "],
   ["    ", # 247
    "****",
    "****",
    "****"],
   ["****", # 248
    "    ",
    "    ",
    "    "],
   ["****", # 249
    "    ",
    "    ",
    "****"],
   ["****", # 250
    "    ",
    "****",
    "    "],
   ["****", # 251
    "    ",
    "****",
    "****"],
   ["****", # 252
    "****",
    "    ",
    "    "],
   ["****", # 253
    "****",
    "    ",
    "****"],
   ["****", # 254 
    "****",
    "****",
    "    "],
   ["****", # 255
    "****",
    "****",
    "****"],
]

with open("font.c", 'w') as f:
    f.write("#include \"bitbox.h\"\n#include \"common.h\"\n#include \"font.h\"\n#include <string.h> // strlen\n")
    f.write("uint16_t font[256] CCM_MEMORY;\n")
    f.write("uint16_t font_cache[256] = {\n")
    if starting_index:
        f.write("[%d]="%starting_index)
    else:
        f.write("  ")
    for i in range(len(characters)):
        char = characters[i]
        x = 0
        for j in range(len(char)):
            power = 4*j
            for c in char[j]:
                if c != ' ':
                    x |= 1<<power
                power += 1
        if i + 1 == len(characters):
            f.write("%d\n"%x)
        else:
            f.write("%d,\n  "%x)
    f.write("};\n")
    if len(characters) + starting_index > 256:
        print "WARNING, overflow!"
    f.write("""
void font_init()
{
    memcpy(font, font_cache, sizeof(font_cache));
}

void font_render_line_doubled(const uint8_t *text, int x, int y, uint16_t color_fg, uint16_t color_bg)
{
    #ifdef EMULATOR
    if (y < 0 || y >= 8)
    {
        message("got too big a line count for text (%s):  %d\\n", text, y);
        return;
    }
    if (x < 0 || x + 9*strlen((char *)text) >= SCREEN_W)
    {
        message("text (%s) goes off screen!\\n", text);
        return;
    }
    #endif
    y = ((y/2))*4; // make y now how much to shift
    uint16_t *dst = draw_buffer + x;
    uint16_t color_choice[2] = { color_bg, color_fg };
    *dst = color_choice[0];
    --text;
    int c;
    while ((c = *(++text)))
    {
        uint8_t row = (font[c] >> y) & 15;
        for (int j=0; j<4; ++j)
        {
            *(++dst) = color_choice[row&1];
            *(++dst) = color_choice[row&1];
            row >>= 1;
        }
        *(++dst) = color_choice[0];
    }
}

void font_render_no_bg_line_doubled(const uint8_t *text, int x, int y, uint16_t color_fg)
{
    #ifdef EMULATOR
    if (y < 0 || y >= 8)
    {
        message("got too big a line count for text (%s):  %d\\n", text, y);
        return;
    }
    if (x < 0 || x + 9*strlen((char *)text) >= SCREEN_W)
    {
        message("text (%s) goes off screen!\\n", text);
        return;
    }
    #endif
    y = ((y/2))*4; // make y now how much to shift
    uint16_t *dst = draw_buffer + x;
    --text;
    int c;
    while ((c = *(++text)))
    {
        uint8_t row = (font[c] >> y) & 15;
        for (int j=0; j<4; ++j)
        {
            if (row&1)
            {
                *(++dst) = color_fg;
                *(++dst) = color_fg;
            }
            else
            {
                dst += 2;
            }
            row >>= 1;
        }
        ++dst;
    }
}
"""
)


with open("font.h", 'w') as f:
    f.write("#ifndef FONT_H\n#define FONT_H\n#include <stdint.h>\n")
    f.write("extern uint16_t font_cache[256];\nextern uint16_t font[256];\nvoid font_init();\nvoid font_render_line_doubled(const uint8_t *text, int x, int y, uint16_t color_fg, uint16_t color_bg);\n")
    f.write("void font_render_no_bg_line_doubled(const uint8_t *text, int x, int y, uint16_t color_fg);\n");
    f.write("#endif\n")
